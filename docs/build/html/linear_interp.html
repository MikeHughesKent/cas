<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Linear Interpolation &mdash; ImageDisplayQT 1.0.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> ImageDisplayQT
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html#linear-interpolation">Linear Interpolation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ImageDisplayQT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Linear Interpolation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/linear_interp.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="linear-interpolation">
<h1>Linear Interpolation<a class="headerlink" href="#linear-interpolation" title="Permalink to this headline"></a></h1>
<p>Triangular linear interpolation can be used to remove the fibre bundle core pattern. Using a calibration image, usually acquired with no object in view (i.e. a flat field), the location of each core is determined. A Delaunay triangulation is performed over the core locations. A reconstruction grid is then defined, and the enclosing triangle for each pixel is determined. Images can then be processed by interpolating the value of each pixel from the brightness of the three surrounding cores. Although calibration can take a few seconds, processing of images can then be at video rate.</p>
<section id="object-oriented-approach">
<h2>Object Oriented Approach<a class="headerlink" href="#object-oriented-approach" title="Permalink to this headline"></a></h2>
<p>Import the <code class="docutils literal notranslate"><span class="pre">PyBundle</span></code> class and instantiate an object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pybundle</span> <span class="kn">import</span> <span class="n">PyBundle</span>
<span class="n">pyb</span> <span class="o">=</span> <span class="n">pybundle</span><span class="o">.</span><span class="n">PyBundle</span><span class="p">()</span>
</pre></div>
</div>
<p>Set the core removal method to triangular linear interpolation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pyb</span><span class="o">.</span><span class="n">set_core_method</span><span class="p">(</span><span class="n">pyb</span><span class="o">.</span><span class="n">TRILIN</span><span class="p">)</span>
</pre></div>
</div>
<p>Set both the calibration and normalisation images to be <code class="docutils literal notranslate"><span class="pre">calibImg</span></code>, a 2D numpy array:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pyb</span><span class="o">.</span><span class="n">set_calib_image</span><span class="p">(</span><span class="n">calibImg</span><span class="p">)</span>
<span class="n">pyb</span><span class="o">.</span><span class="n">set_normalise_image</span><span class="p">(</span><span class="n">calibImg</span><span class="p">)</span>
</pre></div>
</div>
<p>Choose the output images size:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pyb</span><span class="o">.</span><span class="n">set_grid_size</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
</pre></div>
</div>
<p>If we are normalising it is best to get an output image which is auto-contrasted:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pyb</span><span class="o">.</span><span class="n">set_auto_contrast</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Perform the calibration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pyb</span><span class="o">.</span><span class="n">calibrate</span><span class="p">()</span>
</pre></div>
</div>
<p>Remove the fibre bundle pattern from an image <code class="docutils literal notranslate"><span class="pre">img</span></code>, a 2D numpy array:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">imgProc</span> <span class="o">=</span> <span class="n">pyb</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</pre></div>
</div>
<p>For real-time processing, a speed-up of approx X4 in reconstruction can be obtained if the Numba package is installed. To disable use of Numba, call:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pyb</span><span class="o">.</span><span class="n">set_use_numba</span><span class="p">(</span><span class="n">false</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="lower-level-functions">
<h2>Lower level functions<a class="headerlink" href="#lower-level-functions" title="Permalink to this headline"></a></h2>
<p>For greater customisation, the static functions can be called directly. First perform a calibration using the calibration image <code class="docutils literal notranslate"><span class="pre">calibImg</span></code>, a 2D numpy array:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">coreSize</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">gridSize</span> <span class="o">=</span> <span class="mi">512</span>
<span class="n">calib</span> <span class="o">=</span> <span class="n">pybundle</span><span class="o">.</span><span class="n">calib_tri_interp</span><span class="p">(</span><span class="n">calibImg</span><span class="p">,</span> <span class="n">coreSize</span><span class="p">,</span> <span class="n">gridSize</span><span class="p">,</span> <span class="n">normalise</span> <span class="o">=</span> <span class="n">calibImg</span><span class="p">,</span> <span class="n">automask</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Here we have specified <code class="docutils literal notranslate"><span class="pre">coreSize</span> <span class="pre">=</span> <span class="pre">3</span></code> which is the approximate core spacing in the image. This assists the calibration routine in finding all cores. If unknown it can be estimated using <code class="docutils literal notranslate"><span class="pre">find_core_spacing</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">gridSize</span></code> is the number of pixels in each dimensions of the reconstructed image, which is square.</p>
<p>Finally, we have specified to use the <code class="docutils literal notranslate"><span class="pre">calibImg</span></code> for normalisation. This means that the intensity extracted from each core during imaging will be normalised with respect to the intensity from the calibration image, removing effects due to non-uniform cores. If this is not done (i.e. normalise is left as the default <code class="docutils literal notranslate"><span class="pre">None</span></code>) then images may appear grainy.</p>
<p>To reconstruct an image <code class="docutils literal notranslate"><span class="pre">img</span></code>, a 2D numpy array, we then call:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">imgRecon</span> <span class="o">=</span> <span class="n">pybundle</span><span class="o">.</span><span class="n">recon_tri_interp</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">calib</span><span class="p">)</span>
</pre></div>
</div>
<p>This returns a 2D numpy array of size <code class="docutils literal notranslate"><span class="pre">(gridSize,</span> <span class="pre">gridSize)</span></code> containing the image with the core pattern removed.</p>
<p>For all optional parameters refer to the functon reference for <code class="docutils literal notranslate"><span class="pre">calib_tri_interp</span></code> and <code class="docutils literal notranslate"><span class="pre">recon_tri_interp</span></code>.</p>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline"></a></h2>
<p>An example using OOP is in “examples\linear_interp_example.py”.</p>
<p>An example using OOP and showing the difference in speed if Numba is used is in “examples\linear_interp_numba_example.py”.</p>
<p>Linear interpolation is compared with other core method removal techniques in “examples\compare_recons.py”.</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Mike Hughes.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>